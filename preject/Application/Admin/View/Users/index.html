<include file="Public/header" />
<div class="content">
    <include file="Public/nav" />
    <div class="row-fluid fl" id="main">
        <div class="tableBox">
            <div class="titleBar">用户管理/<span>用户列表</span></div>
            <form class="form-search fr" action="__URL__/index" method="get">
                <input type="text" name="name" class="input-medium" placeholder="请输入真实姓名...">
                <button type="submit" class="btn">搜索</button>
            </form>

            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>用户ID</th>
                    <th>姓名</th>
                    <th>手机</th>
                    <th>地址</th>
                    <th>账户余额</th>
                    <th>最后登录</th>
                    <th>登录IP</th>
                    <th>注册时间</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                    <notempty name="list">
                    <foreach name="list" item="vo" key="key">
                    <tr>
                        <td class="userIndex">{{$vo.id}}</td>
                        <td><a class="btn-link detail">{{$vo.name}}</a></td>
                        <td>{{$vo.phone}}</td>
                        <td>{{$vo.address}}</td>
                        <td>{{$vo.balance}}</td>
                        <td>{{$vo.login_time|date='Y-m-d H:i:s',###}}</td>
                        <td>{{$vo.login_ip}}</td>
                        <td>{{$vo.addtime|date='Y-m-d H:i:s',###}}</td>
                        <td>{{$vo.status}}</td>
                        <td>
                            <if condition="$Think.session.adminuser.leavel eq 0">
                                <switch name="vo.status">
                                    <case value="禁用"><a href="__URL__/edit/id/{{$vo.id}}/status/1">启用&nbsp;&nbsp;</a></case>
                                    <case value="启用"><a href="__URL__/edit/id/{{$vo.id}}/status/0">禁用&nbsp;&nbsp;</a></case>
                                    <default />
                                </switch>
                                <a href="__URL__/message/id/{{$vo.id}}">喝水建议</a>
                            <else/>
                                <span>您无操作权限</span>
                            </if>
                        </td>
                    </tr>
                    </foreach>
                    <else />
                    <tr>
                        <td colspan="10">查无数据</td>
                    </tr>
                    </notempty>
                </tbody>
            </table>
            <div class="pagination">
                <ul>
                    {{$button}}
                </ul>
            </div>
            <script>
                $('.pagination ul a').unwrap('div').wrap('<li></li>');
                $('.pagination ul span').wrap('<li class="active"></li>')
            </script>
        </div>
        <!-- footer part -->
        <include file="Public/footer" />
    </div>
</div>
<script type="text/javascript">
    // 用户详情
    $('.detail').click(function (){
        var _this=$(this);
        var id = $(this).parent().siblings(".userIndex").html();
        var thisNum=0;
        var jsonNum=0;//绑定ic卡数量
        var arrayJson=[];
         
        $.ajax({
            url:"usersDetail",
            type:"post",
            dataType:'json',
            data:{id},
            success:function(data){              
                layui.use('layer', function(){
                    var layer = layui.layer;
                    layer.open({
                        type: 1, 
                        title: ['姓名:'+_this.html(), 'font-size:18px;'],
                        area: ['1200px', '680px'],
                        content: $(".showdetail")
                    }); 
                });
                var tableHtml='';
                var deviceInfo='';
                // var obj = eval ("(" + data.icid + ")");
                $(".filterInfoTable tbody").html("<tr><td>充值金额(元)</td><td>充值时间</td></tr>");
                $(".deviceInfoTable tbody").html("<tr><td>用户姓名</td><td>用水量(升)</td><td>用水地点</td><td>用水时间</td></tr>");
                for(var i=0;i<data.record.length;i++){
                    tableHtml+='<tr><td>'+data.record[i].money+'</td><td>'+ getLocalTime(data.record[i].time) +'</td></tr>';
                }
                $(".filterInfoTable tbody").append(tableHtml);

                //消费记录遍历

                for (var countryObj in data.icid)
                { 
                    for (var i = 0;i < data.icid[countryObj].length; i++)
                    {
                        deviceInfo+='<tr><td>'+countryObj+'</td><td>'+data.icid[countryObj][i]["flow"]+'</td><td>'+data.icid[countryObj][i]["address"]+'</td><td>'+getLocalTime(data.icid[countryObj][i]["time"])+'</td></tr>';   
                    }
                }
                $(".deviceInfoTable tbody").append(deviceInfo);
            }
        })
    })
</script>
<div class="showdetail container">
    <div class="fl filterInfo">
        <h3>充值记录</h3>
        <table class="table filterInfoTable"> 
            <tbody>
                
            </tbody>
        </table>
    </div>
    <div class="fl deviceInfo">
        <h3>消费记录</h3>
        <div class="tableList">
            <table class="table deviceInfoTable">
                <tbody>
                    
                </tbody>
            </table>
        </div>
    </div>
</div>
