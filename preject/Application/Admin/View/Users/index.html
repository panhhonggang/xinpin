<include file="Public/header" />
<div class="content">
    <include file="Public/nav" />
    <div class="row-fluid fl" id="main">
        <div class="tableBox">
            <div class="titleBar">用户管理/<span>用户列表</span></div>
            <form class="form-search fr" action="__URL__/index" method="get">
                <input type="text" name="name" class="input-medium" placeholder="请输入真实姓名...">
                <button type="submit" class="btn">搜索</button>
            </form>

            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>用户ID</th>
                    <th>姓名</th>
                    <th>手机</th>
                    <th>地址</th>
                    <th>账户余额</th>
                    <th>最后登录</th>
                    <th>登录IP</th>
                    <th>注册时间</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                    <notempty name="list">
                    <foreach name="list" item="vo" key="key">
                    <tr>
                        <td>{{$vo.id}}</td>
                        <td><a class="btn-link detail">{{$vo.name}}</a></td>
                        <td>{{$vo.phone}}</td>
                        <td>{{$vo.address}}</td>
                        <td>{{$vo.balance}}</td>
                        <td>{{$vo.login_time|date='Y-m-d H:i:s',###}}</td>
                        <td>{{$vo.login_ip}}</td>
                        <td>{{$vo.addtime|date='Y-m-d H:i:s',###}}</td>
                        <td>{{$vo.status}}</td>
                        <td>
                            <if condition="$Think.session.adminuser.leavel eq 0">
                                <switch name="vo.status">
                                    <case value="禁用"><a href="__URL__/edit/id/{{$vo.id}}/status/1">启用&nbsp;&nbsp;</a></case>
                                    <case value="启用"><a href="__URL__/edit/id/{{$vo.id}}/status/0">禁用&nbsp;&nbsp;</a></case>
                                    <default />
                                </switch>
                                <a href="__URL__/message/id/{{$vo.id}}">喝水建议</a>
                            <else/>
                                <span>您无操作权限</span>
                            </if>
                        </td>
                    </tr>
                    </foreach>
                    <else />
                    <tr>
                        <td colspan="10">查无数据</td>
                    </tr>
                    </notempty>
                </tbody>
            </table>
            <div class="pagination">
                <ul>
                    {{$button}}
                </ul>
            </div>
            <script>
                $('.pagination ul a').unwrap('div').wrap('<li></li>');
                $('.pagination ul span').wrap('<li class="active"></li>')
            </script>
        </div>
        <!-- footer part -->
        <include file="Public/footer" />
    </div>
</div>
<script type="text/javascript">
    // 用户详情
    $('.detail').click(function (){
        var code = $(this).html();
        $.ajax({
            url:"usersDetail",
            type:"post",
            dataType:'json',
            data:{code},
            success:function(data){  
            console.log(data);              
                if('给你老王玩了'){
                    layui.use('layer', function(){
                        var layer = layui.layer;
                        layer.open({
                            type: 1, 
                            title: ['设备详情', 'font-size:18px;'],
                            area: ['1200px', '680px'],
                            content: $(".showdetail")
                        }); 
                    });
                    var tableHtml='';
                    var deviceInfo='';
                    $(".filterInfoTable tbody").html("");
                    $(".deviceInfoTable").html("");
                    for(var i=0;i<8;i++){
                        tableHtml+='<tr><td>redayfilter'+(i + 1)+'</td><td>'+ data['redayfilter'+(i + 1)] +'</td></tr>';
                    }
                    $(".filterInfoTable tbody").append(tableHtml);

                    deviceInfo='<tbody><tr><td>设备编号</td><td>'+data.deviceid+'</td></tr><tr><td>安装时间</td><td>'+data.addtime+'</td></tr><tr><td>安装地址</td><td>'+data.loaction+'</td></tr><tr><td>设备状态</td><td>'+data.devicestause+'</td></tr><tr><td>纯水值</td><td>'+data.rawtds+'</td></tr><tr><td>原水值</td><td>'+data.puretds+'</td></tr><tr><td>剩余流量</td><td>'+data.flow+'</td></tr><tr><td>剩余天数</td><td>'+data.reday+'</td></tr><tr><td>租赁模式</td><td>'+data.leasingmode+'</td></tr><tr><td>激活状态</td><td>'+data.alivestause+'</td></tr><tr><td>滤芯模式</td><td>'+data.filtermode+'</td></tr><tr><td>温度</td><td>'+data.temperature+'</td></tr><tr><td>更新时间</td><td>'+data.updatetime+'</td></tr></tbody>';
                    $(".deviceInfoTable").append(deviceInfo);
                } else {
                    layui.use('layer', function(){
                        var layer = layui.layer;
                        layer.msg('参数错误', {icon: 5});
                    });
                } 
            }
        })
    })
</script>
<div class="showdetail container">
    <div class="fl filterInfo">
        <h3>滤芯信息</h3>
        <table class="table filterInfoTable"> 
            <tbody>
                <th>
                    <td>滤芯剩余流量</td>
                    <td></td>
                </th>
            </tbody>
        </table>
    </div>
    <div class="fl deviceInfo">
        <h3>设备信息</h3>
        <table class="table deviceInfoTable">
            
        </table>
    </div>
</div>
