<include file="Public/header" />
<div class="content">
    <include file="Public/nav" />
    <div class="row-fluid fl" id="main" style="background: #ecf0f5;">
        <div class="tableBox">
            <div class="titleBar">设备管理/<span>设备列表</span></div>
            <h1 class="deviceTitle text-center">当前设备：<span>{{$data['deviceid']}}</span>设备详情</h1>
            <div class="keyPointList">
                <div class="fl">
                    <h2>{{$data['devicestause']}}</h2>
                    <p>设备当前状态</p>
                </div>
                <div class="fl">
                    <h2>{{$data['puretds']}}</h2>
                    <p>设备当前原水值</p>
                </div>
                <div class="fl">
                    <h2>{{$data['rawtds']}}</h2>
                    <p>设备当前净水值</p>
                </div>
                <div class="fr">
                    <h2>{{$data['leasingmode']}}</h2>
                    <p>设备当前租赁模式</p>
                </div>
            </div>
            <div class="detailList container">
                <div class="fl leftBox ">
                    <div class=" filterInfo">
                        <h3>滤芯信息</h3>
                        <table class="table filterInfoTable"> 
                            <tbody>
                                <tr>
                                    <td>滤芯项1</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus1"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum1">{{$data['reflowfilter1']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="1">复位</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>滤芯项2</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus2"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum2">{{$data['reflowfilter2']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="2">复位</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>滤芯项3</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus3"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum3">{{$data['reflowfilter3']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="3">复位</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>滤芯项4</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus4"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum4">{{$data['reflowfilter4']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="4">复位</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>滤芯项5</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus5"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum5">{{$data['reflowfilter5']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="5">复位</button>
                                    </td>
                                </tr>

                                <tr>
                                    <td>滤芯项6</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus6"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum6">{{$data['reflowfilter6']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="6">复位</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>滤芯项7</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus7"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum7">{{$data['reflowfilter7']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="7">复位</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>滤芯项8</td>
                                    <td>
                                        <div class="surplusBg">
                                            <p class="surplusShowColor surplus8"></p>
                                        </div>
                                    </td>
                                    <td>
                                        剩<span class="surplusNum8">{{$data['reflowfilter8']}}</span>%
                                    </td>
                                    <td>
                                        <button class="resetBtn clickBtn" name="8">复位</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="deviceOperation">
                        <h3>设备操作</h3>
                        <a>
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <button class="startingUp clickBtn">开机</button>
                        </a>
                        <a>
                            <i></i>
                            <button class="shutDown clickBtn">关机</button>
                        </a>
                    </div>
                </div>
                <div class="deviceInfo">
                    <h3>设备信息</h3>
                    <table class="table deviceInfoTable">
                        <tbody>
                            <tr>
                                <td>设备编号</td>
                                <td>{{$data['deviceid']}}</td> 
                            </tr>
                            <tr>
                                <td>设备状态</td>
                                <td>{{$data['devicestause']}}</td> 
                            </tr>
                            <tr>
                                <td>安装时间</td>
                                <td>{{$data['addtime']}}</td> 
                            </tr>
                            <tr>
                                <td>安装地址</td>
                                <td>{{$data['loaction']}}</td> 
                            </tr>
                            <tr>
                                <td>原水值</td>
                                <td>{{$data['puretds']}}</td> 
                            </tr>
                            <tr>
                                <td>纯水值</td>
                                <td>{{$data['rawtds']}}</td> 
                            </tr>
                            <tr>
                                <td>剩余流量</td>
                                <td>{{$data['reflow']}}</td> 
                            </tr>
                            <tr>
                                <td>剩余天数</td>
                                <td>{{$data['reday']}}</td> 
                            </tr>
                            <tr>
                                <td>租赁模式</td>
                                <td>{{$data['leasingmode']}}</td> 
                            </tr>
                            <tr>
                                <td>激活状态</td>
                                <td>{{$data['alivestause']}}</td> 
                            </tr>
                            <tr>
                                <td>滤芯模式</td>
                                <td>{{$data['filtermode']}}</td> 
                            </tr>
                            <tr>
                                <td>温度</td>
                                <td>{{$data['temperature']}}</td> 
                            </tr>
                            <tr>
                                <td>更新时间</td>
                                <td>{{$data['updatetime']}}</td> 
                            </tr>
                        </tbody>
                    </table>
                    <div class="pagination">
                        <ul>
                            
                        </ul>
                    </div>
                </div>
            </div>
            <!-- <div class="tableList">
                <h3>机主信息列表</h3>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <td>姓名</td>
                            <td>手机号码</td>
                            <td>地址</td>
                            <td>安装日期</td>
                            <td>备注</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <ul>
                        
                    </ul>
                </div>
            </div> -->
            <div class="tableList">
                <h3>经销商信息列表</h3>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <td>经销商ID</td>
                            <td>经销商姓名</td>
                            <td>手机号码</td>
                            <td>地址</td>
                            <td>管理级别</td>
                            <td>添加时间</td>
                            <td>邮箱</td>
                            <td>备注</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{{$vendors['id']}}</td>
                            <td>{{$vendors['name']}}</td>
                            <td>{{$vendors['phone']}}</td>
                            <td>{{$vendors['leavel']}}</td>
                            <td>{{$vendors['addtime']}}</td>
                            <td>{{$vendors['id']}}</td>
                            <td>{{$vendors['email']}}</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <ul>
                        
                    </ul>
                </div>
            </div>
            <!-- <div class="tableList">
                <h3>设备充值记录</h3>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <td>设备ID</td>
                            <td>充值用户</td>
                            <td>手机号码</td>
                            <td>充值金额</td>
                            <td>充值日期</td>
                            <td>充值套餐</td>
                            <td>订单状态</td>
                            <td>备注</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <ul>
                       
                    </ul>
                </div>
            </div> -->
            <!-- <div class="tableList">
                <h3>使用记录</h3>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <td>IC卡编号</td>
                            <td>用户姓名</td>
                            <td>手机号码</td>
                            <td>使用时间</td>
                            <td>使用流量/mL</td>
                            <td>使用地址</td>
                            <td>备注</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                            <td>455</td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <ul>
                        
                    </ul>
                </div>
            </div> -->
        </div>
        <include file="Public/footer" />
    </div>
</div>

<script>
    // function connect(){
    //     var websoket=new WebSocket("ws://120.79.0.105:6001");
    //     return websoket;
    // }
    var websoket= new WebSocket("ws://120.79.0.105:6001");
    websoket.onopen=function(){
        var deviceId=112233445566778;//设备id
         ajson={
                        "DeviceID":deviceId,
                        "PackType":"login",
                        "Vison":0,
                    };
        websoket.send(JSON.stringify(ajson));
    }
    
    $('.clickBtn').click(function(){
        var _this=$(this).text();
        var filterN = $(this).attr('name');
        var deviceId=112233445566778;//设备id
        var ajson;//数据对象

        if(_this!="复位"){
            var tipsText = "确定要"+ _this + deviceId +"吗？";
        } else {
            var tipsText = "确定要"+ _this + "<a>滤芯" + filterN +"</a>吗";
        }

        
        // var websoket = connect();
        layui.use('layer', function(){
            var layer = layui.layer;
            layer.confirm(tipsText, {icon: 3, title:'温馨提示'}, function(index){
                layer.close(index);
                ajson={
                        "DeviceID":deviceId,
                        "PackType":"SetData",
                        "Vison":0,
                    };

               // ajson.PackType='SetData';   
                if(_this=="开机"){
                    ajson['DeviceStause']=8;
                    
                }else if(_this=="关机"){
                    ajson['DeviceStause']=7;
                }else if(_this=="复位"){
                    ajson['ReFlowFilter'+filterN]=0;
                    ajson['ReDayFilter'+filterN]=0;
                }
                websoket.send(JSON.stringify(ajson));
                websoket.onmessage=function(event){
                    // alert(124);
                    var data=event.data;
                    var obj=JSON.parse(data); 
                    console.log(obj.IsSuccess);

                    if(obj.IsSuccess=='7'){
                        console.log(123);

                    }else{
                        console.log(124);
                    }
                }
                
            });
        });
        
        
    });
    //显示剩余滤芯百分比横条
    $(".surplus1").width(parseInt($(".surplusNum1").html())+"%");
    $(".surplus2").width(parseInt($(".surplusNum2").html())+"%");
    $(".surplus3").width(parseInt($(".surplusNum3").html())+"%");
    $(".surplus4").width(parseInt($(".surplusNum4").html())+"%");
    $(".surplus5").width(parseInt($(".surplusNum5").html())+"%");
    $(".surplus6").width(parseInt($(".surplusNum6").html())+"%");
    $(".surplus7").width(parseInt($(".surplusNum7").html())+"%");
    $(".surplus8").width(parseInt($(".surplusNum8").html())+"%");
</script>